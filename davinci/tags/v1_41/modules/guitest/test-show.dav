#

verbose = 1

load_module("gui")

define find_band(obj) {
        bands = obj.qube.band_bin.band_bin_original_band
        for (i = 1 ; i <= length(bands) ; i+=1) {
                if (bands[i] == $1) return(i);
        }
        return(1)
}

define stretch() {
        a = $1
        b = moment(a)
        c = (((a - b[1]) / (b[2]-b[1])) * 255)

        return(byte(c));
}

define showVicar(widgetMap) {

  fileName = $1
  data = load_pds(fileName)
  band = find_band(obj = data, 9)
  data = data.qube.data[,,band]
  data[where data < 0] = 0
  data = stretch(data)

  vtop = gui.create("topLevelShell", name=fileName)
  vicar = gui.create("vicar", vtop, { image = data })
  gui.set(vicar, { inputMode = "MODE_SELECT" })
  gui.realize(vtop)

}

define guishow() {

  items = $1

  top = gui.create("topLevelShell", name="Davinci")
  list = gui.create("list", top)
  gui.set(list, { items = items })
  gui.realize(top)

  cont = 1
  while (cont) {
    e = gui.wait()
    if (e.widget == list) {
      if (e.event == "defaultAction") {
	fileName = gui.get(list).selectedItems[,1]
        showVicar(fileName)
      }
    }
  }

}
