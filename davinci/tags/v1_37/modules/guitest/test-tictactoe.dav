#!/u/jim/src/davinci/davinci -ifv

load_module("gui")

define callback() {
  event = $1
  if (event.event != "arm") {
    return(0)
  }
  widget = event.widget
  state = gui.get(widget).labelString
  if (state == " ") {
    newstate = "X"
  } else if (state == "X") {
    newstate = "O"
  } else {
    newstate = " "
  }
  gui.set(widget, { labelString = newstate })
}

top = gui.create("topLevelShell", "Tic-Tac-Toe")
board = gui.create("rowcolumn", "board", top, { numColumns = 3, orientation = "HORIZONTAL", packing = "PACK_COLUMN" })

# FIX: ask noel why no unary increment/decrement
for (x = 0; x < 3; x += 1) {
  for (y = 0; y < 3; y += 1) {
    b = gui.create("pushbutton", " ", board)
    gui.set(b, { davinciPrivate = "callback" })
  }
}

gui.realize(top)

while (1) {
  event = gui.wait()
  eval(gui.get(event.widget).davinciPrivate + "(event)")
}
