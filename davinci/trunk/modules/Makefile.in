SHELL = /bin/sh

srcdir = @srcdir@
prefix= @prefix@
exec_prefix = $(prefix)
BINDIR = $(exec_prefix)/bin
LIBDIR = $(prefix)/lib
mandir = $(prefix)/man/man1

IMLDFLAGS=-L.. @IMLDFLAGS@ @MODULE_LINK_OPT@
IMLIBS=@IMLIBS@
IMCPPFLAGS=@IMCPPFLAGS@
IMCFLAGS=-DDAVINCI_MODULE -g -I.. @IMCFLAGS@
CC     = @CC@
DEFS   = @DEFS@ 
LINK   = @MODULE_LINKER@

CFLAGS=-DDAVINCI_MODULE -g -I.. @MODULE_CC_OPT@
LDFLAGS=-L.. @MODULE_LINK_OPT@
LDLIBS=@MODULE_ADDN_LIBS@ -lc

.SUFFIXES:	.dvm

MODULES=mod1.dvm mod2.dvm pnm_mod.dvm dvmagick.dvm

all:	$(MODULES)

.o.dvm:
	$(LINK) $(LDFLAGS) $< $(LDLIBS) -o $@
	
.c.o:
	$(CC) -c $(CFLAGS) $(DEFS) $< -o $@

clean:
	-rm -f *.o *.dvm

######################################################
# Dependencies
#

mod1.dvm:	mod1.o Makefile
mod2.dvm:	mod2.o Makefile
pnm_mod.dvm:	pnm_mod.o Makefile
dvmagick.dvm:	dvmagick.o Makefile
mod1.o:	mod1.c ../parser.h
mod2.o:	mod2.c ../parser.h
pnm_mod.o: pnm_mod.c ../parser.h

# ImageMagick is SPE-SHUL!

dvmagick.dvm:   dvmagick.o Makefile
	$(LINK) $(IMLDFLAGS) $< $(IMLIBS) -o $@

dvmagick.o: dvmagick.c ../parser.h
	$(CC) -c $(IMCFLAGS) $(IMCPPFLAGS) $(DEFS) $< -o $@
